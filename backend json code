// ğŸ§  Gifty backend logic â€” works with button clicks + link suggestions

const userMessage = ($json.body?.message || "").toLowerCase();
let reply = "";

// 1ï¸âƒ£ Q&A responses
const qaData = [
  { q: "what is gifty", a: "ğŸ Gifty is an AI-powered assistant that helps you find perfect gifts for any occasion." },
  { q: "who created you", a: "ğŸ’¡ I was created by the ScriptBees team to make gifting smarter and easier!" },
  { q: "how to use gifty", a: "Simply tell me the occasion or person, and Iâ€™ll suggest thoughtful gifts instantly." },
  { q: "what can you do", a: "I can suggest personalized gifts, share product links, and help you explore ideas for birthdays, anniversaries, farewells, and more!" },
  { q: "hi", a: "ğŸ‘‹ Hi! Iâ€™m Gifty â€” your personal gifting assistant. What are you celebrating today?" },
  { q: "hello", a: "ğŸŒŸ Hello there! Tell me your occasion and Iâ€™ll find amazing gift options for you!" },
];

// 2ï¸âƒ£ If message matches any Q&A
const match = qaData.find((pair) => userMessage.includes(pair.q.toLowerCase()));
if (match) {
  reply = match.a;
}

// 3ï¸âƒ£ Show buttons for occasions
else if (userMessage.includes("gift") || userMessage.includes("occasion")) {
  reply = `
  ğŸ’¡ Here are some popular gift occasions you can explore ğŸ<br><br>
  <div style="display:flex;flex-direction:column;gap:10px;">
    <button style="background:#007bff;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;" data-msg="birthday">ğŸ‚ Birthday</button>
    <button style="background:#e91e63;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;" data-msg="anniversary">ğŸ’– Anniversary</button>
    <button style="background:#f06292;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;" data-msg="valentine">â¤ï¸ Valentineâ€™s Day</button>
    <button style="background:#ffa726;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;" data-msg="farewell">ğŸ‘‹ Farewell</button>
    <button style="background:#7e57c2;color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;" data-msg="annual">ğŸ† Annual Day</button>
  </div>
  `;
}

// 4ï¸âƒ£ Birthday gifts
else if (userMessage.includes("birthday")) {
  reply = `
  ğŸ‚ <strong>Birthday Gift Ideas</strong><br><br>
  <ul>
    <li><a href="https://www.amazon.in/s?k=birthday+explosion+box" target="_blank">ğŸ Birthday Explosion Box â€“ Amazon</a></li>
    <li><a href="https://www.amazon.in/s?k=personalized+birthday+mug" target="_blank">â˜• Personalized Birthday Mug â€“ Amazon</a></li>
    <li><a href="https://www.flipkart.com/search?q=birthday+gift+combo" target="_blank">ğŸ‰ Birthday Gift Combo â€“ Flipkart</a></li>
    <li><a href="https://www.flipkart.com/search?q=birthday+greeting+card" target="_blank">ğŸˆ Greeting Card â€“ Flipkart</a></li>
  </ul>`;
}

// 5ï¸âƒ£ Anniversary gifts
else if (userMessage.includes("anniversary")) {
  reply = `
  ğŸ’– <strong>Anniversary Gift Ideas</strong><br><br>
  <ul>
    <li><a href="https://www.amazon.in/s?k=couple+photo+frame+anniversary" target="_blank">ğŸ’ Couple Frame â€“ Amazon</a></li>
    <li><a href="https://www.amazon.in/s?k=heart+led+lamp+anniversary" target="_blank">ğŸ’– Heart LED Lamp â€“ Amazon</a></li>
    <li><a href="https://www.flipkart.com/search?q=anniversary+gift+box" target="_blank">ğŸ’ Romantic Gift Box â€“ Flipkart</a></li>
    <li><a href="https://www.flipkart.com/search?q=romantic+candle+set" target="_blank">ğŸ•¯ï¸ Candle Set â€“ Flipkart</a></li>
  </ul>`;
}

// 6ï¸âƒ£ Valentine gifts
else if (userMessage.includes("valentine")) {
  reply = `
  â¤ï¸ <strong>Valentineâ€™s Day Gift Ideas</strong><br><br>
  <ul>
    <li><a href="https://www.amazon.in/s?k=valentine+gift+hamper" target="_blank">ğŸ’Œ Gift Hamper â€“ Amazon</a></li>
    <li><a href="https://www.amazon.in/s?k=love+explosion+box" target="_blank">ğŸ’– Love Explosion Box â€“ Amazon</a></li>
    <li><a href="https://www.flipkart.com/search?q=valentine+gift+combo" target="_blank">ğŸ’ Combo Set â€“ Flipkart</a></li>
    <li><a href="https://www.flipkart.com/search?q=rose+teddy+gift" target="_blank">ğŸŒ¹ Rose Teddy â€“ Flipkart</a></li>
  </ul>`;
}

// 7ï¸âƒ£ Farewell gifts
else if (userMessage.includes("farewell")) {
  reply = `
  ğŸ‘‹ <strong>Farewell Gift Ideas</strong><br><br>
  <ul>
    <li><a href="https://www.amazon.in/s?k=farewell+mug" target="_blank">â˜• Goodbye Mug â€“ Amazon</a></li>
    <li><a href="https://www.amazon.in/s?k=farewell+diary" target="_blank">ğŸ“– Diary â€“ Amazon</a></li>
    <li><a href="https://www.flipkart.com/search?q=farewell+gift+combo" target="_blank">ğŸ Combo Gift â€“ Flipkart</a></li>
    <li><a href="https://www.flipkart.com/search?q=pen+set+gift" target="_blank">ğŸ–‹ï¸ Pen Set â€“ Flipkart</a></li>
  </ul>`;
}

// 8ï¸âƒ£ Annual Day gifts
else if (userMessage.includes("annual")) {
  reply = `
  ğŸ† <strong>Annual Day Gift Ideas</strong><br><br>
  <ul>
    <li><a href="https://www.amazon.in/s?k=corporate+trophy+gift" target="_blank">ğŸ… Trophy â€“ Amazon</a></li>
    <li><a href="https://www.amazon.in/s?k=appreciation+plaque+award" target="_blank">ğŸ–ï¸ Plaque Award â€“ Amazon</a></li>
    <li><a href="https://www.flipkart.com/search?q=employee+gift+set" target="_blank">ğŸ Gift Set â€“ Flipkart</a></li>
    <li><a href="https://www.flipkart.com/search?q=office+desk+decor+gift" target="_blank">ğŸ•¯ï¸ Desk Decor â€“ Flipkart</a></li>
  </ul>`;
}

// 9ï¸âƒ£ Fallback
if (!reply) {
  reply = "ğŸ¤” Iâ€™m not sure about that. Try asking about birthdays, anniversaries, farewells, or other events!";
}

// âœ… Output
return [{ json: { reply } }];